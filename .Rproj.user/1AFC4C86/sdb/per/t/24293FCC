{
    "contents" : "---\ntitle: \"Storm Data Analysis\"\nauthor: \"Roger Oglesby\"\ndate: \"Sunday , December 21, 2014\"\noutput: html_document\n---\n#### Synopsis\nStorms and other severe weather events can cause both public health and economic problems for \ncommunities and municipalities. Many severe events can result in fatalities, injuries, and \nproperty damage, and preventing such outcomes to the extent possible is a key concern.\n\nThis paper will use data from the U.S. National Oceanic and Atmospheric Administration's \n(NOAA) storm database to address the following questions:  \n1. Across the United States, which types of events (as indicated in the EVTYPE variable) \nare most harmful with respect to population health?  \n2. Across the United States, which types of events have the greatest economic consequences?  \n  \nThe NOAA database tracks characteristics of major storms and weather events in the United States, \nincluding when and where they occur, as well as estimates of any fatalities, injuries, \nand property damage. \n  \n#### Data Processing\nThe Storm Data file has been read from the US NOAA site - https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2. A description of the data is available at https://d396qusza40orc.cloudfront.net/repdata%2Fpeer2_doc%2FNCDC%20Storm%20Events-FAQ%20Page.pdf  \n\nThe first step of the analysis is to read in the comma separated data file and clean the data.  \nThe aim of this paper is to look at the economic impact of major storms and weather events in the United States, so after reading the column names, only a subset of data important to this analysis will be used.\n\n```{r, echo=TRUE}\n# R.utils required to unzip the bz2 file using bzfile function. \n# Load and suppress messages and warnings to keep report tidy.\nsuppressWarnings(suppressMessages(library(R.utils)))\n# Read in first row of CSV data to get names of columns\nsetwd(\"C:/Documents and Settings/Administrator/My Documents/Coursera/Data Science/\")\nStormData <- read.csv(bzfile(\"./repdata-data-STormData.csv.bz2\"),nrows=10)\n# The column names are -\ncolnames(StormData)\n# Now read in all the data, but just columns of interest\nStormData <- read.csv(bzfile(\"./repdata-data-STormData.csv.bz2\"),\n                       nrows=-1)[, c(2, 8, 23, 24, 25, 26, 27, 28)]\n# We now only have columns of interest\ncolnames(StormData)\n# A quick look at some of the raw data...\nstr(StormData)\n# Upper case the Event Type to help tidy up the text.\nStormData$EVTYPE <- toupper(StormData$EVTYPE)\n# How much data is there?\ncnt  <- nrow(StormData)\n# Extract the year portion of the dates\nStormData$BGN_YEAR <- as.numeric(format(as.Date(StormData$BGN_DATE, \"%m/%d/%Y\"), \"%Y\"))\n# How much data is there per year?\nhist(StormData$BGN_YEAR, breaks=80, main= \"Weather Events by Year\", xlab=\"Year\")\n```\n    \nFrom the histogram, the amount of data in the early years is much less than in the later year. \nAs more recent data is stated as being more reliable, only data post 1987 will be used in this analysis. \nThis date is quite arbitrary, but it appears to be the point at which the amount of data begins to pick up.\n   \nThe final step of the clean up approach is to look at the damage expense factors. \n```{r, echo=TRUE}\n# As we are only interested in more recent data, subset everything beyond 1987\n# What values of PROPDMGEXP and CROPDMGEXP codes do we have?\ntable(StormData$PROPDMGEXP[which(StormData$BGN_YEAR > 1987)])\ntable(StormData$CROPDMGEXP[which(StormData$BGN_YEAR > 1987)])\n```\nThere is a lot of noise in the PROPDMGEXP and CROPDMGEXP factors. \nThe only legitimate factors in the data description are \"K\", \"M\" and \"B\" \nfor thousands, millions and billions. \nAll other data will be ignored, including lower case \"k\", \"m\" and \"b\". As the number of observations\ndeleted is small and none seem to indicate billions, the impact on the analysis is deemed small.\n```{r, echo=TRUE}\nStormData <- StormData[which(StormData$BGN_YEAR > 1987), ] \ncntx  <- nrow(StormData)\nStormData <- StormData[which(StormData$PROPDMGEXP %in% c(NA, \"\", \"K\", \"M\", \"B\")), ]\nStormData <- StormData[which(StormData$CROPDMGEXP %in% c(NA, \"\", \"K\", \"M\", \"B\")), ]\n# How much data do we have now?\ncnty  <- nrow(StormData)\n```\nOf the original `r sprintf(\"%7.0f\", cnt)` observations, by excluding early years this \nhas reduced to `r sprintf(\"%7.0f\", cntx)`. The clean up has reduced the number of observations\nfurther to `r sprintf(\"%7.0f\", cnty)`\n```{r, echo=TRUE}\n# Summarise the Fatalities and Injuries by Event Type -\nSumFatal <- aggregate (StormData$FATALITIES, by = list(StormData$EVTYPE), na.rm=TRUE, FUN = sum)\nSumInj <- aggregate (StormData$INJURIES, by = list(StormData$EVTYPE), na.rm=TRUE, FUN = sum)\n# Now re-order the data, most frequent first\nSumFatal <- SumFatal[with(SumFatal, order(-x, Group.1)), ]\nSumInj   <- SumInj[with(SumInj, order(-x, Group.1)), ]\n# List the top 10 fatality types and top 10 injury types\nhead(SumFatal, 10)\nhead(SumInj, 10)\n```\nThe event with the most fatalities is `r SumFatal$Group.1[1]`, \nalthough `r SumFatal$Group.1[2]` causes nearly as many fatalities but also \ncauses by far the most injuries and hence together \ncan be described as the most harmful to population health.\n  \n```{r, echo=TRUE}\n#\n# Summarise Property Damage and Crop Damage\nSumPROP <- aggregate (StormData$PROPDMG,\n                      by = list(StormData$EVTYPE, StormData$PROPDMGEXP), na.rm=TRUE, FUN = sum)\nSumCROP <- aggregate (StormData$CROPDMG,\n                      by = list(StormData$EVTYPE,StormData$CROPDMGEXP), na.rm=TRUE, FUN = sum)\n# Combine the two summaries.\nSumData  <- rbind(SumCROP, SumPROP)\n# Convert the exponents, K=1,000 M=1,000,000 and B = 1,000,000,000, else 1\nexpCodes <- c(\"K\", \"M\", \"B\")\nexpVals <- c(1e+3, 1e+6, 1e+9, 1)\nSumData$val <- expVals[(match(SumData[, \"Group.2\"], expCodes, nomatch = 4))]\nSumData$tot <- SumData$val * SumData$x \n# Now add it all up and round the answers to billions\nTotData  <- aggregate(SumData$tot, by=list(SumData$Group.1), FUN=sum)\nTotData$x  <- round(TotData$x/1000000000, 1)\n# Order the data by descending cost \nTotData <- TotData[with(TotData, order(-x, Group.1)), ]\n# What are the most expensive events since 1987?\nhead(TotData, 10)\n```\nThe `r TotData$Group.1[1]` event clearly causes the largest economic damage \nof $`r sprintf(\"%5.1f\",TotData$x[1])` billion. \nEconomic damage is defined as the sum of Property and Crop damage.    \n  \n#### Results\nTo summarise the conclusions. \n  \n1. Which type of events have been the most harmful to health?  \nThe event types between 1988-2010 which are the most harmful to health are  `r SumFatal$Group.1[1]` \nand `r SumFatal$Group.1[2]`.   \n   \n2. Which type of events have the greatest economic consequences?  \nThe event types with the biggest economic impact between 1988-2010 are `r TotData$Group.1[1]` \nfollowed by `r TotData$Group.1[2]`,\nand `r TotData$Group.1[3]`.\n   ",
    "created" : 1430064773015.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2571463299",
    "id" : "24293FCC",
    "lastKnownWriteTime" : 1419203784,
    "path" : "~/Storm-Data/StormReport.Rmd",
    "project_path" : null,
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_markdown"
}